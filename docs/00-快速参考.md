# 快速参考

## 项目基本信息

- **项目名称**: Fossify Voice Recorder
- **包名**: `org.fossify.voicerecorder`
- **版本**: 1.5.1 (Version Code: 15)
- **最低SDK**: Android 8.0 (API 26)
- **目标SDK**: Android 14 (API 36)
- **开发语言**: Kotlin
- **构建工具**: Gradle (Kotlin DSL)

## 快速编译命令

### Windows (PowerShell)
```powershell
# Debug版本
.\gradlew.bat assembleDebug

# Release版本
.\gradlew.bat assembleRelease

# 特定变体
.\gradlew.bat assembleFossDebug
.\gradlew.bat assembleGplayRelease
```

### Linux/Mac
```bash
# Debug版本
./gradlew assembleDebug

# Release版本
./gradlew assembleRelease

# 特定变体
./gradlew assembleFossDebug
./gradlew assembleGplayRelease
```

## 核心文件位置

### 主要Activity
- `app/src/main/kotlin/.../activities/MainActivity.kt` - 主界面
- `app/src/main/kotlin/.../activities/SplashActivity.kt` - 启动画面

### 主要Fragment
- `app/src/main/kotlin/.../fragments/RecorderFragment.kt` - 录制界面
- `app/src/main/kotlin/.../fragments/PlayerFragment.kt` - 播放界面
- `app/src/main/kotlin/.../fragments/TrashFragment.kt` - 回收站

### 核心服务
- `app/src/main/kotlin/.../services/RecorderService.kt` - 录制服务

### 录制器实现
- `app/src/main/kotlin/.../recorder/Recorder.kt` - 录制器接口
- `app/src/main/kotlin/.../recorder/MediaRecorderWrapper.kt` - M4A/OGG录制
- `app/src/main/kotlin/.../recorder/Mp3Recorder.kt` - MP3录制

### 数据模型
- `app/src/main/kotlin/.../models/Recording.kt` - 录音数据模型
- `app/src/main/kotlin/.../models/Events.kt` - EventBus事件

### 配置
- `app/src/main/kotlin/.../helpers/Config.kt` - 配置管理
- `app/src/main/kotlin/.../helpers/Constants.kt` - 常量定义

## 关键常量

### 录制状态
```kotlin
RECORDING_RUNNING = 0   // 正在录制
RECORDING_STOPPED = 1   // 已停止
RECORDING_PAUSED = 2    // 已暂停
```

### 音频格式
```kotlin
EXTENSION_M4A = 0  // M4A格式
EXTENSION_MP3 = 1  // MP3格式
EXTENSION_OGG = 2  // OGG格式
```

### Service Actions
```kotlin
GET_RECORDER_INFO      // 获取录制信息
STOP_AMPLITUDE_UPDATE  // 停止振幅更新
TOGGLE_PAUSE          // 切换暂停状态
CANCEL_RECORDING      // 取消录制
```

## 主要依赖

| 依赖 | 版本 | 用途 |
|------|------|------|
| fossify-commons | 5.7.2 | 通用库 |
| eventbus | 3.3.1 | 事件总线 |
| audiorecordview | 1.0.5 | 音频可视化 |
| tandroidlame | 1.1 | MP3编码 |
| autofittextview | 0.2.1 | 自适应文本 |

## EventBus事件

| 事件类 | 说明 |
|--------|------|
| `Events.RecordingDuration` | 录制时长更新 |
| `Events.RecordingStatus` | 录制状态更新 |
| `Events.RecordingAmplitude` | 音频振幅更新 |
| `Events.RecordingCompleted` | 录制完成 |
| `Events.RecordingSaved` | 录音保存成功 |
| `Events.RecordingTrashUpdated` | 回收站更新 |

## 常用Gradle任务

```bash
# 清理构建
./gradlew clean

# 编译Debug版本
./gradlew assembleDebug

# 编译Release版本
./gradlew assembleRelease

# 运行测试
./gradlew test

# 查看依赖树
./gradlew app:dependencies

# 生成APK
./gradlew assembleDebug

# 安装到设备
./gradlew installDebug
```

## 项目结构速查

```
org.fossify.voicerecorder/
├── activities/      # Activity类
├── adapters/       # RecyclerView适配器
├── dialogs/        # 对话框
├── extensions/     # Kotlin扩展函数
├── fragments/      # Fragment类
├── helpers/        # 辅助类和常量
├── interfaces/     # 接口定义
├── models/         # 数据模型
├── recorder/       # 录制器实现
├── receivers/      # BroadcastReceiver
└── services/       # Service服务
```

## 权限说明

应用需要以下权限：
- `RECORD_AUDIO` - 录制音频
- `FOREGROUND_SERVICE` - 前台服务
- `FOREGROUND_SERVICE_MICROPHONE` - 麦克风前台服务
- `POST_NOTIFICATIONS` - 显示通知
- `WRITE_EXTERNAL_STORAGE` - 写入存储（Android 10以下）

## 构建变体

- **core**: 核心版本
- **foss**: FOSS版本
- **gplay**: Google Play版本

每种变体都有Debug和Release版本。

## 配置文件

- `build.gradle.kts` - 项目构建配置
- `app/build.gradle.kts` - 应用构建配置
- `gradle/libs.versions.toml` - 依赖版本管理
- `gradle.properties` - Gradle属性
- `settings.gradle.kts` - 项目设置

## 调试技巧

1. **查看日志**
   ```bash
   adb logcat | grep voicerecorder
   ```

2. **查看EventBus事件**
   - 在EventBus订阅方法中添加日志
   - 使用EventBus的调试模式

3. **调试Service**
   - 在RecorderService中添加断点
   - 使用Android Studio的Attach Debugger

4. **查看录制文件**
   - 默认路径: `/sdcard/Recordings/`
   - 可通过设置修改

## 常见问题速查

| 问题 | 解决方案 |
|------|----------|
| 编译失败 | 检查JDK版本（需要17） |
| 依赖下载慢 | 配置代理或使用镜像 |
| 找不到SDK | 安装Android SDK Platform 36 |
| 签名错误 | 配置keystore.properties |
| 权限被拒绝 | 检查AndroidManifest.xml |

## 相关文档

- [项目概述](./01-项目概述.md)
- [项目架构](./02-项目架构.md)
- [依赖关系](./03-依赖关系.md)
- [核心模块详解](./04-核心模块详解.md)
- [编译指南](./05-编译指南.md)

---

**提示**: 这是快速参考，详细说明请查看对应的文档。

